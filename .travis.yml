language: csharp
sudo: required
mono: none
dist: xenial
dotnet: 2.2.204

addons:
  apt:
    packages:
      - lynx


branches:
  except:
    - 1.0
    - 2.0
    - 2.1
    - dse_3.1
    
matrix:
  include:
    - env:
        - TARGETF="netcoreapp2.1"
        - BUILD_EXAMPLES="1"
    - env:
        - TARGETF="netcoreapp2.0"
        - BUILD_EXAMPLES="0"

script:
  - |
    if [ "${BUILD_EXAMPLES}" == "1" ]
    then
        dotnet restore examples
        dotnet build --no-restore examples/examples.sln -c Release /p:BuildCoreOnly=True
    fi
  - dotnet restore src
  - dotnet build src/Cassandra.Tests/Cassandra.Tests.csproj --no-restore -c Release /p:BuildCoreOnly=True
  - dotnet test src/Cassandra.Tests/Cassandra.Tests.csproj --no-restore --no-build -v n -c Release -f $TARGETF --logger:"nunit;LogFilePath=test-result.xml"
  - if [ -f /home/travis/build/datastax/csharp-driver/src/Cassandra.Tests/test-result.xml ]; then lynx -dump /home/travis/build/datastax/csharp-driver/src/Cassandra.Tests/test-result.xml; fi